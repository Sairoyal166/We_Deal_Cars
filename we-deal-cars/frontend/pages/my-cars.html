<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Cars</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <h1>My Cars</h1>
    <nav>
        <a href="sell-car.html">Sell My Car</a>
        <a href="buy-car.html">Buy a Car</a>
        <a href="my-cars.html">My Cars</a>
        <button onclick="logout()" style="margin-left: 20px;">Logout</button>
    </nav>
    <table>
        <thead>
            <tr>
                <th>Model</th>
                <th>Price</th>
                <th>Image</th>
                <th>Details</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="myCarsTable">
            <!-- Cars will be loaded here -->
        </tbody>
    </table>

    <script>
        async function fetchMyCars() {
            const userId = localStorage.getItem('userId'); // Get logged in user's ID
            if (!userId) {
                alert('Please login first!');
                window.location.href = 'login.html';
                return;
            }

            const response = await fetch(`http://localhost:5000/api/cars/user/${userId}`);
            const cars = await response.json();

            const tableBody = document.getElementById('myCarsTable');
            tableBody.innerHTML = '';

            cars.forEach(car => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${car.model}</td>
                    <td>${car.price}</td>
                    <td><img src="${car.image}" alt="${car.model}" width="100"></td>
                    <td>${car.details}</td>
                    <td>
                        <button onclick="editCar(${car.id})">Edit</button>
                        <button onclick="deleteCar(${car.id})">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        async function deleteCar(carId) {
            if (confirm('Are you sure you want to delete this car?')) {
                const response = await fetch(`http://localhost:5000/api/cars/delete/${carId}`, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    alert('Car deleted successfully.');
                    fetchMyCars();
                } else {
                    alert('Failed to delete car.');
                }
            }
        }

        function editCar(carId) {
            // Store the carId in localStorage and redirect to edit page (optional)
            localStorage.setItem('editCarId', carId);
            window.location.href = 'edit-car.html'; // We can create this page next if you want!
        }

        fetchMyCars();

        function logout() {
    // Clear localStorage
    localStorage.removeItem('userId');
    localStorage.removeItem('userName');
    localStorage.removeItem('editCarId'); // Clear any edit car id also if needed

    // Redirect to login page
    window.location.href = 'login.html';
}

    </script>
</body>
</html>
